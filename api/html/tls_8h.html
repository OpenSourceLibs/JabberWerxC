<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>JabberWerxC: tls.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">JabberWerxC
   &#160;<span id="projectnumber">2015.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_849b60ffe128985f6c5d0ef3e5284e22.html">include</a></li><li class="navelem"><a class="el" href="dir_9e648087d18bc011163f1fa270b33ab2.html">jabberwerx</a></li><li class="navelem"><a class="el" href="dir_458481024303e9c7b064885d89445b10.html">crypto</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tls.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions and data structures for TLS over <code>jw_stream</code>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;event2/bufferevent.h&gt;</code><br />
<code>#include &quot;<a class="el" href="stream_8h_source.html">../stream.h</a>&quot;</code><br />
</div>
<p><a href="tls_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structjw__tls__accept__cb__htable__value__t.html">jw_tls_accept_cb_htable_value_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a304f07fa37129284faee173354e11eec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a304f07fa37129284faee173354e11eec">JW_TLS_CONFIG_REQUIRED</a>&#160;&#160;&#160;&quot;tls-required&quot;</td></tr>
<tr class="separator:a304f07fa37129284faee173354e11eec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0297c8ec6c258c1793254129ade3de16"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a0297c8ec6c258c1793254129ade3de16">JW_TLS_CONFIG_ACCEPT_CB</a>&#160;&#160;&#160;&quot;tls-accept-cb&quot;</td></tr>
<tr class="separator:a0297c8ec6c258c1793254129ade3de16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80e675fa683e684cda3aa2c2d1b43518"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a80e675fa683e684cda3aa2c2d1b43518">JW_TLS_CONFIG_ACCEPT_CB_ARG</a>&#160;&#160;&#160;&quot;tls-accept-cb-arg&quot;</td></tr>
<tr class="separator:a80e675fa683e684cda3aa2c2d1b43518"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a8e1dfc3cd81c2e6dadc43dbf8b9517fe"><td class="memItemLeft" align="right" valign="top">typedef struct _jw_tls_ctx_int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a></td></tr>
<tr class="separator:a8e1dfc3cd81c2e6dadc43dbf8b9517fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39a97d6818fd5946430699550dd3b0e9"><td class="memItemLeft" align="right" valign="top">typedef struct _jw_tls_session_int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a39a97d6818fd5946430699550dd3b0e9">jw_tls_session</a></td></tr>
<tr class="separator:a39a97d6818fd5946430699550dd3b0e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19aeee8f54e4d1ec2aa75e3af318b9b1"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a19aeee8f54e4d1ec2aa75e3af318b9b1">jw_tls_accept_cb</a>) (<a class="el" href="tls_8h.html#a39a97d6818fd5946430699550dd3b0e9">jw_tls_session</a> *sess, void *arg)</td></tr>
<tr class="separator:a19aeee8f54e4d1ec2aa75e3af318b9b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06cee347481e791fc008095666909512"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structjw__tls__accept__cb__htable__value__t.html">jw_tls_accept_cb_htable_value_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a06cee347481e791fc008095666909512">jw_tls_accept_cb_htable_value</a></td></tr>
<tr class="separator:a06cee347481e791fc008095666909512"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a869829564f1b4fc2d09b1fb2b6791b2d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a869829564f1b4fc2d09b1fb2b6791b2d">jw_tls_context_create</a> (<a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> **ctx, <a class="el" href="structjw__err.html">jw_err</a> *err)</td></tr>
<tr class="separator:a869829564f1b4fc2d09b1fb2b6791b2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29ef728180931293230f0d037019c9aa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a29ef728180931293230f0d037019c9aa">jw_tls_context_destroy</a> (<a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *ctx)</td></tr>
<tr class="separator:a29ef728180931293230f0d037019c9aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad923641bc6732b701eac2989eaee869c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#ad923641bc6732b701eac2989eaee869c">jw_tls_filter_stream</a> (<a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *ctx, <a class="el" href="stream_8h.html#a3aae910bace352397e6983c32fa25abd">jw_stream</a> *stream, <a class="el" href="tls_8h.html#a19aeee8f54e4d1ec2aa75e3af318b9b1">jw_tls_accept_cb</a> accept_cb, <a class="el" href="structjw__err.html">jw_err</a> *err)</td></tr>
<tr class="separator:ad923641bc6732b701eac2989eaee869c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b79e7efa3994268b7f59c361cc96448"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a9b79e7efa3994268b7f59c361cc96448">jw_tls_socket_create</a> (<a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *ctx, <a class="el" href="stream_8h.html#a3aae910bace352397e6983c32fa25abd">jw_stream</a> *stream, <a class="el" href="tls_8h.html#a19aeee8f54e4d1ec2aa75e3af318b9b1">jw_tls_accept_cb</a> accept_cb, struct bufferevent **bev, <a class="el" href="structjw__err.html">jw_err</a> *err)</td></tr>
<tr class="separator:a9b79e7efa3994268b7f59c361cc96448"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56d853b5eff28805122ef2a31e11a1dd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#a56d853b5eff28805122ef2a31e11a1dd">jw_tls_use_cert_chain</a> (<a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *ctx, const char *cert_file, const char *private_key_file, <a class="el" href="structjw__err.html">jw_err</a> *err)</td></tr>
<tr class="separator:a56d853b5eff28805122ef2a31e11a1dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace580d76aee8c94c6878ea04c06f6098"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#ace580d76aee8c94c6878ea04c06f6098">jw_tls_proceed</a> (<a class="el" href="tls_8h.html#a39a97d6818fd5946430699550dd3b0e9">jw_tls_session</a> *sess, bool accept)</td></tr>
<tr class="separator:ace580d76aee8c94c6878ea04c06f6098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac86a01c100b7038d3258801a0938187b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#ac86a01c100b7038d3258801a0938187b">jw_tls_initialize</a> (<a class="el" href="structjw__err.html">jw_err</a> *err)</td></tr>
<tr class="separator:ac86a01c100b7038d3258801a0938187b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1480a4e515ce47a011db88596cf5f05"><td class="memItemLeft" align="right" valign="top"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8h.html#ad1480a4e515ce47a011db88596cf5f05">jw_tls_terminate</a> ()</td></tr>
<tr class="separator:ad1480a4e515ce47a011db88596cf5f05"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions and data structures for TLS over <code>jw_stream</code>. </p>
<p>Copyrights</p>
<p>Portions created or assigned to Cisco Systems, Inc. are Copyright (c) 2010-2015 Cisco Systems, Inc. All Rights Reserved. See LICENSE for details. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a0297c8ec6c258c1793254129ade3de16"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define JW_TLS_CONFIG_ACCEPT_CB&#160;&#160;&#160;&quot;tls-accept-cb&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configuration option to specify a callback triggered when an invalid certificate is found during TLS negotiation. The value of this option MUST be a <code>jw_tls_accept_cb_htable_value</code>. </p>

</div>
</div>
<a class="anchor" id="a80e675fa683e684cda3aa2c2d1b43518"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define JW_TLS_CONFIG_ACCEPT_CB_ARG&#160;&#160;&#160;&quot;tls-accept-cb-arg&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configuration option for a user defined argument passed through the TLS accept callback specified by JW_TLS_CONFIG_ACCEPT_CB. If this option is not supplied a NULL will be passed to the accept callback. </p>

</div>
</div>
<a class="anchor" id="a304f07fa37129284faee173354e11eec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define JW_TLS_CONFIG_REQUIRED&#160;&#160;&#160;&quot;tls-required&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configuration option to specify TLS is mandatory. The value of this option MUST be (bool)(uintptr_t) </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a19aeee8f54e4d1ec2aa75e3af318b9b1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* jw_tls_accept_cb) (<a class="el" href="tls_8h.html#a39a97d6818fd5946430699550dd3b0e9">jw_tls_session</a> *sess, void *arg)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>TLS certificate acceptance callback.</p>
<p>A callback fired when a certificate has failed validation during a handshake attempt. The user queries the given <code>jw_tls_session</code> for certificate information (todo implement) to determine if the certificate should be accepted anyway. The user MUST call <code>jw_tls_proceed</code> with the given TLS session to continue negotiation and finish connection.</p>
<p>The accept callback may be optionally referenced in the <code>jw_htable</code> configuration passed to <code>jw_tls_context_create</code>. Since function and data pointers can not be cast to one another, the usual jw_htable getters and setters cannot be used with the callback directly. Instead the callback should be wrapped in a <code>jw_tls_accept_cb_htable_value</code> and that union callback pointer reference should be added to the table using the JW_TLS_CONFIG_ACCEPT_CB key.</p>
<p>Users may also specify an argument to be passed through the accept callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sess</td><td>The SSL handshake results (used with <code>jw_tls_proceed</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">arg</td><td>An optional user supplied argument bound to this callback. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a06cee347481e791fc008095666909512"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structjw__tls__accept__cb__htable__value__t.html">jw_tls_accept_cb_htable_value_t</a>  <a class="el" href="tls_8h.html#a06cee347481e791fc008095666909512">jw_tls_accept_cb_htable_value</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A hashtable container for the accept callback.</p>
<p><code>jw_tls_accept_cb_htable_value</code> cb_val { .cb = myCallbackFn }; <code>jw_htable_put(config, JW_TLS_CONFIG_ACCEPT_CB, &amp;cb_val, NULL, NULL)</code>; </p>

</div>
</div>
<a class="anchor" id="a8e1dfc3cd81c2e6dadc43dbf8b9517fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct _jw_tls_ctx_int <a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>An instance of an TLS context.</p>
<p>The context is used to create SSL bufferevents and is analogous to the openssl SSL_CTX type. </p>

</div>
</div>
<a class="anchor" id="a39a97d6818fd5946430699550dd3b0e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct _jw_tls_session_int <a class="el" href="tls_8h.html#a39a97d6818fd5946430699550dd3b0e9">jw_tls_session</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A jw_tls_session represents the results of a handshake attempt. This pointer is passed to the acceptance callback (see below) and may be queried for validation error information.</p>
<p>The session is passed to jw_tls_proceed to complete the handshake.</p>
<p>todo provide getters for a sessions stream and bufferevent </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a869829564f1b4fc2d09b1fb2b6791b2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool jw_tls_context_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> **&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structjw__err.html">jw_err</a> *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a new TLS/SSL context.</p>
<p>An SSL context is used to create bufferevents associated with a particular jw_stream (</p><dl class="section see"><dt>See also</dt><dd><a class="el" href="tls_8h.html#ad923641bc6732b701eac2989eaee869c">jw_tls_filter_stream</a>, </dd>
<dd>
<a class="el" href="tls_8h.html#a9b79e7efa3994268b7f59c361cc96448">jw_tls_socket_create</a>). <a class="el" href="stream_8h.html#a3aae910bace352397e6983c32fa25abd">jw_stream</a> may have a single, usually socket, bufferevent that can be used as a base for an SSL filter. The JabberWerxC TCP socket stream is an example of this type of stream.</dd></dl>
<p>Alternately a jw_stream may be an abstraction without an underlying bufferevent. These types of streams (BOSH for example) control their own TCP connections and would use one or more SSL socket bufferevent for actual I/O. Each SSL filter or socket is a seperate "SSL session". A single SSL context may be used to for multiple streams and each stream may have multiple sessions.</p>
<p>The stream is used during construction for its options hash table. and cached for later use in other jw_tls functions. For instance the jw_tls_filter_create function creates a TLS filter using the stream's bufferevent. Stream may be closed or reopened by the context while handling connection.</p>
<p>Once the stream has successfully connected (with no errors or with accepted validations errors) future connects will never validate certificates</p>
<p>This function can generate the following errors (set when returning false): </p><ul>
<li><code>JW_ERR_NO_MEMORY</code> if the context could not be allocated. </li>
<li><code>JW_ERR_NOT_IMPLEMENTED</code> if TLS support is has not been compiled into this distribution. </li>
<li><code>JW_ERR_INVALID_STATE</code> if other errors occur.</li>
</ul>
<dl class="section invariant"><dt>Invariant</dt><dd>stream != NULL </dd>
<dd>
ctx != NULL </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">ctx</td><td>The newly constructed context </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">err</td><td>The error information (provide NULL to ignore) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true on success, else false. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a29ef728180931293230f0d037019c9aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> void jw_tls_context_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy the given tls context by freeing resources and performing library cleanup as needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>The context to destroy </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad923641bc6732b701eac2989eaee869c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool jw_tls_filter_stream </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stream_8h.html#a3aae910bace352397e6983c32fa25abd">jw_stream</a> *&#160;</td>
          <td class="paramname"><em>stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a19aeee8f54e4d1ec2aa75e3af318b9b1">jw_tls_accept_cb</a>&#160;</td>
          <td class="paramname"><em>accept_cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structjw__err.html">jw_err</a> *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a transport layer security bufferevent filter on the given stream and start SSL handshake.</p>
<p>This function creates a TLS enabled filter on the given stream. Only one filter can be created per jw_stream.</p>
<p>A connection attempt is started during construction per protocol: A TLS context MUST only be created after &lt;proceed/&gt; has been received during STARTTLS negotiation (rfc6120 5.4.2.3). The context will immediately attempt TLS negotiation following rfc6120 5.4.3.1 with the exceptions of: 3 - the initiating entity SHOULD send a certificate to the receiving entity</p><ul>
<li>cert exchange is not supported. 5 - cert validation. todo make sure supported libs follow spec.</li>
</ul>
<p>Buffer I/O is suspended until a successful connection. It is safe to write to the stream during this time and no read events will be triggered. Buffer events are deferred, ensuring correct event order is preserved. On success the stream will be reopened and all subsequent stream reads/writes will be decrypted/encrypted.</p>
<p>On certificate validation failure an optional callback will be triggered (</p><dl class="section see"><dt>See also</dt><dd><a class="el" href="tls_8h.html#ace580d76aee8c94c6878ea04c06f6098">jw_tls_proceed</a>). Connection (completion of handshake) will continue once <a class="el" href="tls_8h.html#ace580d76aee8c94c6878ea04c06f6098">jw_tls_proceed</a> has been called (</dd>
<dd>
<a class="el" href="tls_8h.html#a19aeee8f54e4d1ec2aa75e3af318b9b1">jw_tls_accept_cb</a>). Other failures will cause the stream to be closed with an appropriate error.</dd></dl>
<p>This function takes an optional override acceptance callback. The override exists so that a controller can easily replace a user supplied cb without having to modify the stream's configuration. This mechanism allows the controller to coordinate acceptance between sockets for instance.</p>
<p>This function can generate the following errors (set when returning false): </p><ul>
<li><code>JW_ERR_NO_MEMORY</code> if an allocation error occurred </li>
<li><code>JW_ERR_NOT_IMPLEMENTED</code> if TLS support is has not been compiled into this distribution. </li>
<li><code>JW_ERR_INVALID_STATE</code> if other errors occur.</li>
</ul>
<dl class="section invariant"><dt>Invariant</dt><dd>ctx != NULL </dd>
<dd>
stream != NULL </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>The TLS context to use </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stream</td><td>The stream to filter </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">accept_cb</td><td>An optional override of the configured accept callback </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">err</td><td>The error information (provide NULL to ignore) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true on success, else false. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac86a01c100b7038d3258801a0938187b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool jw_tls_initialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structjw__err.html">jw_err</a> *&#160;</td>
          <td class="paramname"><em>err</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>do any onetime ssl library initialization.</p>
<p>This function can generate the following errors (set when returning false): </p><ul>
<li><code>JW_ERR_NO_MEMORY</code> if an allocation error occurred during initialization </li>
<li><code>JW_ERR_NOT_IMPLEMENTED</code> if TLS support is has not been compiled into this distribution.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">err</td><td>the error if on occurred </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true on success, else false. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ace580d76aee8c94c6878ea04c06f6098"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> void jw_tls_proceed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a39a97d6818fd5946430699550dd3b0e9">jw_tls_session</a> *&#160;</td>
          <td class="paramname"><em>sess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>accept</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allow a paused TLS connection to proceed or fail.</p>
<p>If an invalid certificate is found during the SSL negotiation the connection attempt is paused and an optional <code>jw_tls_accept_cb</code> callback fired. Once the callback has been triggered, the user MUST call <code>jw_tls_proceedt</code> to complete the connection. If the callback is not provided <code>jw_tls_proceed(ctx, false)</code> is called on the users behalf.</p>
<p>The <code>accept</code> parameter determines whether the connection should fail or continue authentication by validating the problem certificate.</p>
<p>This function is a noop if the given TLS context is not paused for a certificate review.</p>
<dl class="section invariant"><dt>Invariant</dt><dd>sess != NULL </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sess</td><td>The TLS connection context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">accept</td><td>True if connection should proceed, False if the connection should fail. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">enum</td><td>bufferevent_flush_mode The destination buffer flush mode. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9b79e7efa3994268b7f59c361cc96448"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool jw_tls_socket_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stream_8h.html#a3aae910bace352397e6983c32fa25abd">jw_stream</a> *&#160;</td>
          <td class="paramname"><em>stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a19aeee8f54e4d1ec2aa75e3af318b9b1">jw_tls_accept_cb</a>&#160;</td>
          <td class="paramname"><em>accept_cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct bufferevent **&#160;</td>
          <td class="paramname"><em>bev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structjw__err.html">jw_err</a> *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an SSL bufferevent socket.</p>
<p>Using the given context create a new SSL enabled bufferevent socket. The socket is not initially bound to a file descriptor and will not attempt connection until later configuration.</p>
<p>The resultant socket will not attempt to validate certificates during subsequent connections but will log any errors found during their validation. (todo implement acceptance callback for sockets)</p>
<p>This function takes an optional override acceptance callback. The override exists so that a controller can easily replace a user supplied cb without having to modify the stream's configuration. This mechanism allows the controller to coordinate acceptance between sockets for instance.</p>
<p>This function can generate the following errors (set when returning false): </p><ul>
<li><code>JW_ERR_NO_MEMORY</code> if an allocation error occurred during construction. </li>
<li><code>JW_ERR_NOT_IMPLEMENTED</code> if TLS support is has not been compiled into this distribution.</li>
</ul>
<dl class="section invariant"><dt>Invariant</dt><dd>ctx != NULL </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>The SSL context (and jw_stream) to use </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stream</td><td>The jw_stream this socket is part of. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">accept_cb</td><td>An optional override of the configured acceptance cb. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">bev</td><td>The newly created SSL enabled bufferevent </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">err</td><td>The error information (provide NULL to ignore) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true on success, else false. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad1480a4e515ce47a011db88596cf5f05"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> void jw_tls_terminate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cleanup any TLS data structures and resources.</p>
<p>While TLS initialization is performed by a jw_client (by calling jw_tls_initialize at an appropriate time), jw_tls_terminate should be called by the jw_client owner after the client's destruction (or at the end of program execution if multiple jw_clients are used).</p>
<p><b>NOTE:</b> After this function is called, direct TLS operations (e.g. calling OpenSSL directly) MUST NOT be performed. </p>

</div>
</div>
<a class="anchor" id="a56d853b5eff28805122ef2a31e11a1dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="basics_8h.html#a83a72fcd21631ca7baf97aaaa2778200">JABBERWERX_API</a> bool jw_tls_use_cert_chain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a8e1dfc3cd81c2e6dadc43dbf8b9517fe">jw_tls_ctx</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cert_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>private_key_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structjw__err.html">jw_err</a> *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Associate a client certificate chain and private key to use for mutual TLS authentication.</p>
<p>This function can generate the following errors (set when returning false): </p><ul>
<li><code>JW_ERR_NOT_IMPLEMENTED</code> if TLS support is has not been compiled into this distribution. </li>
<li><code>JW_ERR_BAD_FORMAT</code> if the specified files could not be loaded</li>
</ul>
<dl class="section invariant"><dt>Invariant</dt><dd>ctx != NULL </dd>
<dd>
cert_file != NULL </dd>
<dd>
private_key_file != NULL </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>the SSL context to use </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert_file</td><td>the name of the file from which to load the cert chain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">private_key_file</td><td>the name of the file from which to load the private key </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">err</td><td>The error information (provide NULL to ignore) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true on success, else false. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jul 8 2015 12:17:54 for JabberWerxC by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
